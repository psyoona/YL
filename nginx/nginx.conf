# Nginx 프로세스를 실행할 사용자 계정 지정 (권한 관리 목적)
user  nginx;

# IIS 워커 프로세스와 유사한 개념: auto면 CPU 코어 수에 맞춰 워커 프로세스 개수 자동 설정
worker_processes  auto;

events {
  # 워커 프로세스 1개당 동시에 처리 가능한 연결 수
  # 총 동시 연결 수 = worker_processes × worker_connections
  worker_connections 1024;
}

http {
  # MIME 타입 매핑 파일 불러오기 (확장자 → Content-Type 매핑)
  include       /etc/nginx/mime.types;

  # MIME 타입을 찾을 수 없는 경우 기본값 지정
  default_type  application/octet-stream;

  # sendfile() 시스템 호출을 사용해 파일 전송 (성능 최적화)
  sendfile on;

  # Keep-Alive 연결 유지 시간 (초)
  keepalive_timeout 65;

  # 클라이언트 요청 본문 최대 허용 크기 (업로드 제한)
  client_max_body_size 50m;

  # W3C 로그 포맷 정의 (IIS W3C 로그 스타일과 유사)
  log_format w3c '$time_local $server_addr '                # 요청 시간, 서버 IP
                 '$request_method $http_host $uri $args '   # 메서드, Host, URI, 쿼리스트링
                 '$remote_addr "$http_user_agent" '         # 클라이언트 IP, User-Agent
                 '$status $body_bytes_sent $request_length ' # HTTP 상태, 응답 바이트 수, 요청 크기
                 '$request_time $upstream_response_time';   # 요청 처리 시간, 업스트림 응답 시간

  # 액세스 로그 파일 경로 및 사용할 로그 포맷 지정
  access_log /var/log/nginx/access.log w3c;

  # 에러 로그 파일 경로와 로그 레벨 지정 (warn 이상 기록)
  error_log  /var/log/nginx/error.log warn;

  # /etc/nginx/conf.d 디렉토리의 모든 conf 파일 포함 (가상 호스트/서버 블록 등)
  include /etc/nginx/conf.d/*.conf;
}
